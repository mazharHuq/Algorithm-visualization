<!DOCTYPE html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Visualizations - Expression Tree</title>

<!--css-->
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/viz.css">

<link rel="stylesheet" href="css/bst.css">

<!--js-->
<script src="js/external/jquery-1.10.2.js"></script>
<script src="js/external/jquery-ui.js"></script>
<script src="js/viz.js"></script>
<script src="js/common.js"></script>
<script src="js/actions/bst_actions.js"></script>
<script src="//connect.facebook.net/en_US/all.js"></script>
<script src="js/external/d3.v3.js"></script>
<!-- more scripts are below-->

<!--fonts-->
<link href="fonts/silkscreen/stylesheet.css" rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>

</head>

<body>
	<div class="top-bar shadow mt-2 bg-white">
        <div class="array-container container mx-auto flex space-x-3 items-center font-mono">
            <label for="expression-Input" class="font-bold text-xl">Enter Expression</label>
    
                <input id="expression-input" type="text" class="w-full text-lg bg-gray-100  p-3" value="">
            <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg" id="buildTree">
              Build Tree
            </button>
        </div>
    </div>

    <div id="viz"></div>

<script src="js/graph_library/constant.js"></script>
<script src="js/graph_library/properties.js"></script>
<script src="js/graph_library/helperObjects.js"></script>
<script src="js/graph_library/misc.js"></script>
<script src="js/graph_library/Widget.js"></script>
<script src="js/graph_library/GraphWidget.js"></script>
<script src="js/graph_library/GraphVertexWidget.js"></script>
<script src="js/graph_library/GraphEdgeWidget.js"></script>
<script src="js/widgets/BstWidget.js"></script>

<script type="text/javascript">

	
	

	$('#play').hide();
	//this viz-specific code
	$('#buildTree').on('click',function(){
	//bstWidget.dummyInit;
		var expression = $('#expression-input').val();
		let bstWidget = new BST(expression);
		let gw = bstWidget.getGraphWidget();
		console.log(expression);
	});

	//title changing
	$('#title-BST').click(function() {
		if(isPlaying) {	stop(); }
		closeSearch();
		closeInsert();
		closeRemove();
		showActionsPanel();
		hideStatusPanel();
		hideCodetracePanel();
		bstWidget.isAVL(false);
	});


	
	function inorderTraversal(){
		if(isPlaying) {	stop(); }
		setTimeout( function() {
			if((mode=="exploration")&&bstWidget.inorderTraversal()) {
				$('#current-action').show();
				$('#current-action p').html("In-order Traversal");
				$('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
				$('#inorder-err').html("");
				closeSearch();
				closeInsert();
				triggerRightPanels();
				isPlaying = true;
			}
		}, 500);
    }
	
	//playback controls might fit better in viz.js, but put here in case some viz does not use GraphWidgetNew.js
	var isPaused = false;
	function isAtEnd() {
		return (gw.getCurrentIteration()==(gw.getTotalIteration()-1));
	}
	
	function pause() {
		if(isPlaying) {
			isPaused = true;
			gw.pause();
			$('#play').show();
			$('#pause').hide();
		}
	}
	function play() {
		if(isPlaying) {
			isPaused = false;
			$('#pause').show();
			$('#play').hide();
			if(isAtEnd()) {
				gw.replay();
			} else {
				gw.play();
			}
		}
	}
	function stepForward() {
		if(isPlaying) {
			pause();
			gw.forceNext(250);
		}
	}
	function stepBackward() {
		if(isPlaying) {
			pause();
			gw.forcePrevious(250);	
		}
	}
	function goToBeginning() {
		if(isPlaying) {
			gw.jumpToIteration(0,0);
			pause();
		}
	}
	function goToEnd() {
		if(isPlaying) {
			gw.jumpToIteration(gw.getTotalIteration()-1,0);
			pause();
		}
	}
	function stop() {
		gw.stop();
		isPaused = false;
		isPlaying = false;
		$('#pause').show();
		$('#play').hide();
		$('#current-action').hide();
	}
	
	//shortcut keys for playback controls
	$(document).keydown( function(event) {
		if(event.which == 32) { //spacebar
			if(isPaused) { play(); } else { pause(); }
		} else if(event.which == 37) { //left arrow
			stepBackward();
		} else if(event.which == 39) { //right arrow
			stepForward();
		} else if(event.which == 35) { //end
			stop();
		} else if (event.which == 189) { //minus
			var d = (2200-gw.getAnimationDuration())-100;
			if(d > 0) {
				$("#speed-input").slider("value", d);
			} else {
				$("#speed-input").slider("value", 0);
			}
		} else if (event.which == 187) { //plus
			var d = (2200-gw.getAnimationDuration())+100;
			if(d <= 2000) {
				$("#speed-input").slider("value", d);
			} else {
				$("#speed-input").slider("value", 2000);
			}
		}
	});
	
	//sliders
	$("#speed-input").slider({
		min: 200,
		max: 2000,
		value: 1700,
		change: function(event, ui) {
			gw.setAnimationDuration(2200-ui.value);
		}
	});
	$("#progress-bar").slider({
		range: "min",
		min: 0,
		value: 0,
		slide: function(event, ui) {
			gw.pause();
			gw.jumpToIteration(ui.value,0);
		},
		stop: function(event, ui) {
			if(!isPaused) { setTimeout( function(){gw.play();}, 500) }
		}
	});
	
</script>

</body>
</html>